<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->

    <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-database.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-firestore.js"></script>
    <script src="config.js"></script>
    <style type="text/css">
        .red-star {
            color: red;
        }

        .container {
            text-align: center;
            align-items: center;
        }

        .form-control {
            width: 50%;
        }

        #emailTB {
            margin: 0 auto;
        }

        #passwordTB {
            margin: 0 auto;
        }
    </style>
    <script>

        //firebase.auth().onAuthStateChanged(function (user) {
        //    if (user) {
        //        // User is signed in.
                
        //    } else {
        //        // No user is signed in.
        //    }
        //});
        //function Init() {
        //    ref = firebase.database().ref("users");
        //}

        function storeToLS() {
            user = { // create a new JSON object
                id: document.getElementById("idTB").value,
                password: document.getElementById("passwordTB").value
            }
            // stringify before storing in localstorage
            //הערה
            localStorage["user"] = JSON.stringify(user);
            alert("inLS");
        }

        function Login() {

            let _id = $("#idTB").val();
            let _password = $("#passwordTB").val();
            ref = firebase.database().ref("users");
            ref.child(_id).get().then(function (snapshot) {
                if (snapshot.exists()) {
                    u = snapshot.val();
                    console.log(u);
                    if (u.password == _password) {
                        storeToLS();
                        alert("התחברת בהצלחה");
                    }
                }
                else {
                   alert("אתה לא קיים יא אפס");
                }
            }).catch(function (error) {
                console.error(error);
            });

            
        }
        function Logout() {
            firebase.auth().signOut().then(() => {
  // Sign-out successful.
                localStorage.clear();
            }).catch((error) => {
                alert(error);
  // An error happened.
          });
        }

    </script>
</head>
<body>
    <div class="container">
        <h2>Login user</h2>
        <div class="form-group">
            <label for="idTB"><span class="red-star">★ </span>תעודת זהות</label>
            <input type="text" class="form-control" id="idTB" placeholder="הכנס תעודת זהות" pattern="[0-9]{9}"
                   maxlength="9"
                   oninvalid="this.setCustomValidity('אנא הכנס תעודת זהות כולל ספרת ביקורת')"
                   oninput="this.setCustomValidity('')"
                   required />
        </div>
        <div class="form-group">
            <label for="passwordTB"><span class="red-star">★ </span>סיסמה</label>
            <input type="password" class="form-control" id="passwordTB" placeholder="הכנס סיסמה" minlength="8"
                   pattern="^(?=.*\d)(?=.*[A-Z]).{8,30}$"
                   oninvalid="this.setCustomValidity('Password validator Requires min 8 characters and including at least 1 upper alpha, and 1 digit')"
                   oninput="this.setCustomValidity('')"
                   required />
        </div>
        <button  onclick="Login()">Login</button>
        <button id="send" onclick="Logout()">התנתק</button>
    </div>
</body>
</html>