<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="../Scripts/ajaxCalls.js"></script>
    <script src="../Scripts/jquery-3.4.1.min.js"></script>
    <style type="text/css">
        .red-star {
            color: red;
        }

        .container {
            text-align: center;
            align-items: center;
        }

        .form-control {
            width: 50%;
        }

        #emailTB {
            margin: 0 auto;
        }

        #passwordTB {
            margin: 0 auto;
        }
    </style>
    <script>

        $(document).ready(function () {
            $("#pForm").submit(f1); // bind the submit event to a function called f1
        });

       
        function storeToLS() {
            user = { // create a new JSON object
                email: document.getElementById("emailTB").value,
                password: document.getElementById("passwordTB").value
            }
            // stringify before storing in localstorage
            localStorage["user"] = JSON.stringify(user); 
        }

        

        function GetLogin() {
            
            let _email = $("#emailTB").val();
            let _password = $("#passwordTB").val();
            let api = "../api/Customers/" + _email +"/"+ _password;
            ajaxCall("GET", api, "", getSuccess, getError);
        }
        //new
        function getSuccess(data) {
            storeToLS();
            document.location.href = "UpdateHighlights.html";
            swal("Login was successfull", "success");
        }


        // This function is called in case of an error
        function getError(err) {
            console.log(err);
            swal({
                icon: 'error',
                title: 'Oops..',
                text: err.responseJSON.Message
            });
        }

        function f1() {
            GetLogin();
            return false; // the return false will prevent the form from being submitted
            // hence the page will not reload
        }

    </script>
</head>
<body>
    <div class="container">
        <form id="pForm">
            <h2>Login</h2>
            <div class="form-group">
                <label for="emailTB"><span class="red-star">★ </span>E-mail</label>
                <input type="email" class="form-control" id="emailTB" placeholder="Enter your E-mail" required />
            </div>
            <div class="form-group">
                <label for="passwordTB"><span class="red-star">★ </span>Password</label>
                <input type="password" class="form-control" id="passwordTB" placeholder="Enter your password" minlength="8"
                       pattern="^(?=.*\d)(?=.*[A-Z]).{8,30}$"
                       oninvalid="this.setCustomValidity('Password validator Requires min 8 characters and including at least 1 upper alpha, and 1 digit')"
                       oninput="this.setCustomValidity('')"
                       required />
            </div>
            <div id="ph"> </div>
            <input type="submit" value="Login" />
        </form>
    </div>
</body>
</html>