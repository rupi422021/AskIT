<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>


    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->

    <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-database.js"></script>

    <script src="config.js"></script>

    <style type="text/css">

        img {
            height:200px;
            margin-left:50px;
        }

        span, input {
           font-size:20px;
        }

        div {
            text-align:center;
        }

        .block {
            
            width: 300px;
            border: none;
            background-color: #4CAF50;
            height:40px;
            font-size: 20px;
            cursor: pointer;
            text-align: center;
            margin-bottom:60px;
        }

    </style>

    <script>

        function init() {

            // get a reference to the database
            ref = firebase.database().ref("Project");
            // listen to new Institute which are opened
            listenToNewInstitutes();
            listenToNewDep();
        }

        function createInstitute() {
            
            // create a new institute object
            let name = document.getElementById("instTB").value;
            let institute = {
                status : "Active",
                name: name
            }
            // push a new game into the db
            ref.push().set({ "institute": institute});  
            
        }


        function listenToNewInstitutes() {
            // child_added is triggered once for each existing child
            // and then again every time a new child is added to the
            // pecified path

            // the returned object is called snapshot,
            // it has a key and a value
            ref.on("child_added", snapshot => {              

                // note that the value is addreded via a function             
                        
                    // get the key of the open game
                    instituteIndex = snapshot.key; 

                    // show the game div
                   // document.getElementById("playDiv").style.display = "block";

                    // note that we listen on a specific game
                    // for which we need the key 
                   // listenToEndGame();
            })
        }

        function listenToNewDep() {
            // child_added is triggered once for each existing child
            // and then again every time a new child is added to the
            // pecified path

            // the returned object is called snapshot,
            // it has a key and a value
            ref.on("child_added", snapshot => {              

                // note that the value is addreded via a function             
                        
                    // get the key of the open game
                    departmentsIndex = snapshot.key; 

                    // show the game div
                   // document.getElementById("playDiv").style.display = "block";

                    // note that we listen on a specific game
                    // for which we need the key 
                   // listenToEndGame();
            })
        }
        //function listenToEndGame() {
        //    // this will be called every time there is a change in the value
        //    // of the game object 
        //        ref.child(gameIndex).child("game").on("value", snapshot => {
        //            if (snapshot.val().status == "end") {
        //                checkWinner(snapshot.val().players);
        //                document.getElementById("playDiv").style.display = "none";
        //            }
        //        })
        //}


        // find out the winner
        //function checkWinner(players) {
        //    p1 = players[0];
        //    p2 = players[1];
        //    if (p1.dec == p2.dec) {
        //        str = "Tie at " + p1.dec;
        //    }
        //    else if ((p1.dec == "rock"     && p2.dec == "scissors") ||
        //             (p1.dec == "scissors" && p2.dec == "paper")    ||
        //             (p1.dec == "paper"    && p2.dec == "rock")) {
        //        str = p1.dec + " Beats " + p2.dec + " : " + p1.name + " wins";
        //    }
        //    else {
        //        str = p2.dec + " Beats " + p1.dec + " : " + p2.name + " wins";
        //    }
            
        //    document.getElementById("ph").innerHTML = "<h2>" + str + "</h2>";
            
        //}

        // handle the play event of the users
        function AddDEP() {
            ref.child(instituteIndex).once("value", snapshot => {
                if (typeof (snapshot.val().institute.departments) == 'undefined') {
                    departments = []; // in case it is the first player
                }
                else {
                    // in case it is the second player
                    departments = snapshot.val().institute.departments;
                }
                let name = document.getElementById("depTB").value;
               
                departments.push({
                    "name": name                    
                })
                // update the database with the players object
                ref.child(instituteIndex).child("institute").child("departments").set(departments);
            })
        }

          function AddCOURSE() {
            ref.child(instituteIndex+departmentsIndex).once("value", snapshot => {
                if (typeof (snapshot.val().institute.departments.courses) == 'undefined') {
                    courses = []; // in case it is the first player
                }
                else {
                    // in case it is the second player
                    courses = snapshot.val().institute.departments.courses;
                }
                let name = document.getElementById("CourseTB").value;

                courses.push({
                    "name": name                    
                })
                // update the database with the players object
                ref.child(instituteIndex+departmentsIndex).child("departments").child("courses").set(courses);
            })
        }



      </script>





</head>
<body onload="init()">


    <input type="text" id="instTB" placeholder="Enter Institute Name" />
    <!--<button onclick="AddName()">Add Name</button>-->
    <button onclick="createInstitute()">Add Institute</button>

    <br />
    <br />

    <input type="text" id="depTB" placeholder="Enter Department Name" />
    <button onclick="AddDEP()">Add Department</button>


    <br />
    <br />

    <input type="text" id="CourseTB" placeholder="Enter Course Name" />
    <button onclick="AddCOURSE()">Add Course</button>


    <br />
    <br />

    <input type="text" id="delTB" placeholder="enter substring to delete" />
    <button onclick="deleteInstBySubString()">Delete Institute</button>


    <div id="ph"></div>

    <!--<div>
        <span>enter your name:</span> <input type="text" id="nameTB" />
        <br />
        <br />
        <button onclick="startGame()" class="block">Start The Game</button>
    </div>


    <div id="playDiv" style="display:none">
        <img src="images/r.png" onclick="play('rock')" />
        <img src="images/p.png" onclick="play('paper')" />
        <img src="images/s.png" onclick="play('scissors')" />
    </div>
    <div id="ph"></div>-->

</body>
</html>